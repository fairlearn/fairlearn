parameters:
- name: stageName
  type: string
- name: previousStages
  type: string
  default: PredeploymentValidation
- name:  poolImage
  type: string
  default: 'ubuntu-latest'
- name: poolPythonVersion
  type: number
  default: 3.6
- name: packageArtifactName
  type: string
- name: freezeArtifactStem
  type: string

stages:
- stage: ${{parameters.stageName}}
  displayName: Test Wheel from Artifact
  dependsOn: ${{parameters.previousStages}}
  pool:
    vmImage: ${{parameters.poolImage}}

  jobs:
    - template: all-tests-job-template.yml
      parameters:
        platforms: { Linux: ubuntu-latest, Windows: vs2017-win2016 }
        installationType: 'WheelArtifact'
        pyVersions: [3.5, 3.6, 3.7, 3.8]
        freezeArtifactStem: ${{parameters.freezeArtifactStem}}
        freezeFileStem: requirements-wheel-test
        wheelArtifactName: ${{parameters.packageArtifactName}}

    - template: all-tests-job-template.yml
        parameters:
          platforms: { MacOS: macos-latest }
          testRunTypes: ['Unit']
          installationType: 'WheelArtifact'
          pyVersions: [3.5, 3.6, 3.7, 3.8]
          freezeArtifactStem: ${{parameters.freezeArtifactStem}}
          freezeFileStem: requirements-wheel-test
          wheelArtifactName: ${{parameters.packageArtifactName}}
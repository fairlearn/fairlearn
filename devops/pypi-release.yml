variables:
  poolImage: "ubuntu-latest"
  poolPythonVersion: 3.6
  testPackageArtifact: TestPackages
  testVersionArtifact: TestVersion
  testVersionFilename: 'version-test.txt'
  prodPackageArtifact: ProdPackages
  prodVersionArtifact: ProdVersion
  prodVersionFilename: 'version.txt'

trigger: none # No CI build

pr: none # Not for pull requests


stages:
- stage: PreDeploymentValidation
  pool:
    vmImage: $(PoolImage)
    
  jobs:
  - template: all-tests-job-template.yml
    parameters:
      name: Linux
      vmImage: 'ubuntu-16.04' # Will want to add other platforms and pyVersions back in eventually
      pyVersions: [3.6] 

  # Remove notebooks in the interests of speed

  - job: Experiment
    pool:
      vmImage: $(PoolImage)

    steps:
    - script: ls
    - script: rm -rf fairlearn/ *.md docs/ devops/
    - script: ls 


# =================================================================================================================

# We rely on the implicit dependence on the previous stage
# No fan out/fan in of stages
- template: pypi-deployment-stages-template.yml
  parameters:
    poolImage: $(PoolImage)
    targetType: 'Test'



# =================================================================================================================

- template: pypi-deployment-stages-template.yml
  parameters:
    poolImage: $(PoolImage)
    targetType: 'Prod'
    targetEnvironment: 'PyPI Deployment'
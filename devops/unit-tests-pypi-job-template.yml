parameters:
  name: ''
  vmImage: ''
  pyVersions: [3.5, 3.6, 3.7]
  requirementsFile: 'requirements.txt'
  gitUrl: https://github.com/fairlearn/fairlearn.git
  gitCheckoutTarget: master
  pipUrl: https://test.pypi.org/simple/
  pipVersionArtifact:

jobs:
- job: ${{ parameters.name }}
  pool:
    vmImage: ${{ parameters.vmImage }}
  strategy:
    maxParallel: 2
    matrix:
      ${{ each pyVer in parameters.pyVersions }}:
        ${{ pyVer }}:
          PyVer: ${{ pyVer }}

  steps:
  - task: UsePythonVersion@0
    displayName: 'Use Python $(PyVer)'
    inputs:
      versionSpec: '$(PyVer)' 
      addToPath: true

  - task: PowerShell@2
    name: PrepareGit
    displayName: "Clone from GitHub and checkout $(gitCheckoutTarget)"
    inputs:
      filePath: scripts/prepare-git-pypi-test.ps1
      arguments: "-gitUrl ${{parameters.gitUrl}} -baseDir $(Agent.TempDirectory) -targetVariable ClonedRepoDir -gitCheckout ${{parameters.gitCheckoutTarget}}"
      pwsh: true

  - script: pip install -r ${{ parameters.requirementsFile }}
    displayName: 'Install required packages specified in ${{ parameters.requirementsFile }}'
    workingDirectory: $(ClonedRepoDir)
